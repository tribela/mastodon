@use 'base';
@use 'dark';
@use 'light';
@use '../../mastodon/theme/dark' as mastodon-dark;
@use '../../mastodon/theme/light' as mastodon-light;
@use '../../mastodon/theme/utils' as utils;

html {
  @include base.palette;

  &:where([data-user-theme='system']),
  &:where([data-user-theme='qdon']),
  &:where([data-user-theme='qdon-big']) {
    color-scheme: dark light;

    @media (prefers-color-scheme: dark) {
      @include mastodon-dark.tokens;
      @include utils.invert-on-dark;
      @include dark.tokens;
    }

    @media (prefers-color-scheme: light) {
      @include mastodon-light.tokens;
      @include utils.invert-on-light;
      @include light.tokens;
    }
  }
}

// Dark theme fallback (default when qdon stylesheet is loaded)
.theme-dark,
html:where(
  :not(
    [data-user-theme='qdon'],
    [data-user-theme='qdon-dark'],
    [data-user-theme='qdon-light'],
    [data-user-theme='qdon-big'],
    [data-user-theme='qdon-big-dark'],
    [data-user-theme='qdon-big-light']
  )
) {
  color-scheme: dark;

  @include mastodon-dark.tokens;
  @include utils.invert-on-dark;
  @include dark.tokens;
}

// Dark theme (qdon-dark skin - fixed dark mode)
html:where([data-user-theme='qdon-dark']),
html:where([data-user-theme='qdon-big-dark']) {
  color-scheme: dark;

  @include mastodon-dark.tokens;
  @include utils.invert-on-dark;
  @include dark.tokens;
}

// Light theme (qdon-light skin - fixed light mode)
.theme-light,
html:where([data-user-theme='qdon-light']),
html:where([data-user-theme='qdon-big-light']) {
  color-scheme: light;

  @include mastodon-light.tokens;
  @include utils.invert-on-light;
  @include light.tokens;
}
